#### 动态路由设计方案

方案一 由服务方生成动态路由，并通知业务方
方案二 服务方与业务方约定路由生成规则

#### 分析

由于业务方与服务方都是分布式，且要求路由可以不定期变换，因此方案一实现比较困难。
由两方规定路由生成规则，业务方请求过来的路由只要符合规则，服务方都要接受，
考虑到的问题点：动态路由的生命周期不易过长，易长容易遭受攻击，因此生成路由的规则中需要包含时间元素。
参考算法 TOTP 与 HOTP

#### 实现方法

+ 生成方案

设定当前时间戳：T 单位秒

设定动态路由有效期为：expire 单位秒 具体实践中为10分钟即600秒。

c = T/expire 得到商c

dynamicId = GenRoute(c)

+ 校验方案

已有路由id：rawId

c = T/expire 得到商c

dyId1 = GenRoute(c)

当前时间范围生成的：dyId1 可能和 rawId 不同。

进而生成 T的上一个时间周期，得到dyId2 = GenRoute(c-1)

进而生成 T的下一个时间周期，得到dyId3 = GenRoute(c+1)

rawId 只要和dyId1、dyId2、dyId3比中之一即认为该路由有效。

落后当前时间一个周期，或超前一个周期，都是允许的，这样提高了容错能力。

对于绝大多数请求 只需比对dyId1或dyId2即可比中，很小比例情况下会出现dyId3。

具体实践中设定有效期为10分钟，即使极端情况在路由生成方案及秘钥暴露的情况下，恶意攻击也难以在这么短的时间内造成域名被封。

秘钥未暴露的情况下，攻击时间最多有20分钟，秘钥暴露的情况下攻击时间最多30分钟。